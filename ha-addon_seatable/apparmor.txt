#include <tunables/global>

profile seatable flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  
  # Capabilities
  capability setgid,
  capability setuid,
  capability dac_override,
  capability net_bind_service,
  capability sys_nice,
  capability sys_resource,
  
  # Network access
  network inet tcp,
  network inet udp,
  
  # Allow reads to all directories
  /                 r,
  /**               r,
  
  # Allow writes to specific directories
  /opt/seatable/**  rwkl,
  /tmp/**           rwkl,
  /var/log/**       rwkl,
  /var/lib/mysql/** rwkl,
  /var/run/**       rwkl,
  
  # Home Assistant access
  /data/**          rwkl,
  
  # System calls
  mount,
  umount,
  umount2,
  
  # Executable binary permissions
  /bin/**           ix,
  /usr/bin/**       ix,
  /opt/seatable/**  ix,
  /sbin/**          ix,
  /usr/sbin/**      ix,
  
  # Bash interpreter access
  /bin/bash         ix,
  /bin/dash         ix,
  
  # System command permissions
  /usr/bin/mysql    ix,
  /usr/bin/mysqld   ix,
  /usr/bin/redis-server ix,
  
  # Kill signal handling
  signal (receive) peer=unconfined,
  signal (send,receive) peer=seatable,
}